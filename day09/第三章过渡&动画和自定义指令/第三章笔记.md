# 第三章 **Vue** 过渡&动画和自定义指令

## 3.1过渡&动画效果

### **3.1.1** 什么是过渡&动画

元素在显示和隐藏时，实现过滤或者动画的效果。常用的过渡和动画都是使用CSS来实现的

![img](file:///media\wps3.png)在CSS中操作transition（过滤）或animation（动画）达到不同效果

![img](file:///media\wps8.png)为目标元素添加一个父元素<transition name="xxx">,让父元素通过自动应用类名来达到效果

![img](file:///media\wps9.png)过渡与动画时，会为对应元素动态添加的相关类名：

​		1.xxx-enter:定义显示前的效果。

​		2.xxx-enter-active:定义显示过程的效果。

​		3.xxx-enter-to:定义显示后的效果。

​		4.xxx-leave:定义隐藏前的效果。

​		5.xxx-leave-active定义隐藏过程的效果。

​		6.xxx-leave-to定义隐藏后的效果。

![img](media\wps12.jpg) 

 

### 3.1.2过度效果案例

1. 为目标元素添加父元素<transition name="xxx">

2. 定义 class 过渡样式

   指定过渡样式:transition

   指定隐藏时的样式: opacity(持续的时间)/其它

3. 功能实现

   ![img](file:///media\wps15.png)点击按钮后, 显示隐藏文本

   ![img](file:///media\wps16.png)效果1：显示和隐藏有渐变效果

   ![img](file:///media\wps18.png)效果2：显示和隐藏的有平移效果，并持续时长不同

![img](media\wps17.jpg)

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        /* 显示或隐藏的过渡效果 */
        .v-enter-active,.v-leave-active{
            transition: opacity 1s;
        }
        /* 显示前后隐藏后的效果 */
        .v-enter,.v-leave-to{
            opacity: 0;
        }
        /* 可以针对显示和隐藏指定不同的效果 */
        /* 显示过渡效果 1s*/
        .va-enter-active{
            transition: all 1s;
        }
        /* 隐藏过渡效果 3s*/
        .va-leave-active{
            transition: all 3s;
        }
        /* 显示前后隐藏后的效果 */
        .va-enter,.va-leave-to{
            opacity: 0;
            transform: translateX(10px);
        }
    </style>
</head>
<body>
    <div id="app1">
        <button @click="show=!show">渐变过渡</button>
        <transition name="v">
            <p v-show="show">测试测试测试</p>
        </transition>
    </div>
    <div id="app2">
        <button @click="show=!show">渐变平滑过渡</button>
        <transition name="va">
            <p v-show="show">测试测试测试</p>
        </transition>
    </div>
    <script src="./node_modules/vue/dist/vue.js"></script>
    <script>
        new Vue({
            el:"#app1",
            data:{
                show:true
            }
        })
        new Vue({
            el:"#app2",
            data:{
                show:true
            }
        })
    </script>
</body>
</html>
```

### **3.1.3** 动画效果案例

![img](file:///media\wps25.png)CSS 动画用法同 CSS 过渡，只不过采用animation为指定动画效果

![img](file:///media\wps27.png)功能实现：

![img](file:///media\wps28.png)点击按钮后, 文本内容有放大缩小效果

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        /* 显示过程中的动画效果 */
        .bounce-enter-active {
            animation: bounce-in 1s;
        }
        /* 隐藏过程中的动画效果 */
        .bounce-leave-active {
            animation: bounce-in 1s reverse;
        }

        @keyframes bounce-in {
            0% {/*持续时长百分比，比如1s，0%代表0秒，50%代表0.5秒*/
                transform: scale(0);/*缩小为0*/
            }

            50% {
                transform: scale(1.5); /*放大1.5倍*/
            }

            100% {
                transform: scale(1); /*原始大小*/
            }
        }
    </style>
</head>

<body>
    <div id="demo">
        <button @click="show=!show">放大缩小动画</button>
        <br>
        <transition name="bounce">
            <p v-if="show" style="display: inline-block;">测试文字，测试文字</p>
            <!-- <p v-show="show" >测试文字，测试文字</p> -->
        </transition>
    </div>
    <script src="./node_modules/vue/dist/vue.js"></script>
    <script>
        new Vue({
            el: "#demo",
            data: {
                show: true
            }
        })
    </script>
</body>

</html>
```



## **3.2** Vue 内置指令总结

参考：[https://cn.vuejs.org/v2/api/#](https://cn.vuejs.org/v2/api/)指令

![img](file:///media\wps37.png)[v-html ](#v-html)内容按普通 HTML 插入，可防止 XSS 攻击

![img](file:///media\wps38.png)[v-show ](#v-show)根据表达式的真假值，切换元素的fisplayCSS属性来显示隐藏元素

![img](file:///media\wps40.png)[v-if ](#v-if)根据表达式的真假值，来渲染元素

![img](file:///media\wps41.png)[v-else ](#v-else)前面必须有v-if或v-else-if

![img](file:///media\wps44.png)[v-else-if ](#v-else-if)前面必须有v-if或v-else-if

![img](file:///media\wps47.png)[v-for ](#v-for)遍历的数组或对象

![img](file:///media\wps48.png)[v-on ](#v-on)绑定事件监听器

![img](file:///media\wps49.png)[v-bind ](#v-bind)用于绑定元素属性

![img](file:///media\wps50.png)[v-model ](#v-model)在表单控件或者组件上创建双向绑定

![img](file:///media\wps51.png)[v-once ](#v-once)一次性插值，当后面数据更新后视图数据不会更新

![img](file:///media\wps52.png)[v-pre ](#v-pre)可以用来显示原始插入值标签 {{}} 。并跳过这个元素和它的子元素的编译过程。加快编译。

**例如**：网页中的一篇文章，文章内容不需要被 Vue 管理渲染，则可以在此元素上添加v-pre忽略文章编译提高性能。

  ![img](file:///media\wps57.png) 

v- ![img](file:///media\wps58.png)[text](#v-text)

![img](file:///media\wps59.png)等价于{{}}用于显示内容，但区别在于:

![img](file:///media\wps61.png){{}}会造成闪烁问题， v-text 不会闪烁



![img](file:///media\wps66.png)如果还想用{{}}又不想有闪烁问题，则使用v-cloak来处理

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        /* 将带有v-clock属性的标签隐藏 */
        [v-cloak]{
            display: none;
        }
    </style>
</head>
<body>
    <!-- 官网中=》学习=》API=》指令 -->
    <div id="demo" v-cloak>
        <!-- 
            v-pre
            1,用于显示双大括号{{}}
            2,跳过这个元素和它的子元素的编译过程，这样可以提高性能
         -->
        <span v-pre>
            {{测试文本}}
        </span>
        <!-- 通过双大括号，会有双括号{{}} 闪烁出来，可以
            用过v-text进行解决闪烁问题

            如果就需要使用双大括号，又不想让它有{{}}闪烁
            1. 在被 Vue 管理的模板入口(也就是id为demo那个div)节点上作用 v-cloak 指令
            2. 添加一个属性选择器 [v-cloak] 的CSS 隐藏样式： [v-cloak] {display: none;}
        -->
        <h3>{{msg}}</h3>
        <h3>{{msg}}</h3>
        <h3>{{msg}}</h3>
        <h3 v-text="msg"></h3>
        <h3 v-text="msg"></h3>
    </div>
    <script src="./node_modules/vue/dist/vue.js"></script>
    <script>
        new Vue({
            el:"#demo",
            data:{
                msg:"测试测试测试"
            }
        })
    </script>
</body>
</html>
```

![img](file:///media\wps68.png)[v-cloak](#v-cloak)

![img](file:///media\wps69.png)如果还想用{{}}又不想有闪烁问题，则使用v-cloak来处理,步骤如下：

1. 在被 Vue 管理的模板入口节点上作用v-cloak指令
2. 添加一个属性选择器 [v-cloak] 的CSS 隐藏样式： [v-cloak] {display: none;}

![img](file:///media\wps74.png)原理：默认一开始被 Vue 管理的模板是隐藏着的，当 Vue 解析处理完 DOM 模板之后，会自动把这个样式去除，然后就显示出来。

## **3.3** 自定义指令

### **3.3.1** 自定义指令的作用

除了内置指令外，Vue 也允许注册自定义指令。有的情况下，你仍然需要对普通 DOM  元素进行底层操作，这时候使用自定义指令更为方便。

自定义指令文档： https://cn.vuejs.org/v2/guide/custom-directive.html

### **3.3.2** 注册与使用自定义指令方式

1. 注册全局指令:

![img](file:///media\wps76.png) 

2. 注册局部指令

 ![img](file:///media\wps77.png)

注意：注册时，指令名不要带 v-

3. 使用指令：

![img](file:///media\wps78.png)**引用指令时，指令名前面加上** **v-**

![img](file:///media\wps80.png)直接在元素上在使用即可 ： v-指令名='表达式'

### **3.3.3** 案例演示

![img](file:///media\wps81.png)需求：

1. !实现输出文本内容全部自动转为大写，字体为红色 ( 功能类型于 v-text , 但显示内容为大写)

2. 当页面加载时，该元素将获得焦点 (注意： autofocus 在移动版 Safari 上不工作)

![img](file:///media\wps84.jpg) 

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div id="app">
        <p v-upper-text="message">xxxx</p>
        自动获取焦点：<input type="text" v-focus>
    </div>
    <script src="./node_modules/vue/dist/vue.js"></script>
    <script>
        // 全局自定义指令
        // 第一个参数为指令名，但是不要v-开头
        Vue.directive("upper-text",{
            // 一般对样式的操作在bind中，bind函数只调用一次
            bind:function(el){
                el.style.color="red";
            },
            // 一般对js操作在inserted中，也只调用一次
            // el是当前指令作用的那个Dom元素
            // binding用于获取使用了当前指令的绑定值(value)，表达式(expression),指令名(name)等
            inserted:function(el,binding){
                //将所有文本内容转换成大写
                el.innerHTML = binding.value.toUpperCase();
            }
        })
        new Vue({
            el:"#app",
            data:{
                message:"buka,测试数据"
            },
            //注册局部的自定义指令
            directives:{
                "focus":{//指令名
                    inserted:function(el,binding){//要执行的功能
                        //被v-focus作用的那个元素在刷新页面后会自动获取焦点
                        el.focus();
                    }
                }
            }
        })
    </script>
</body>
</html>
```

